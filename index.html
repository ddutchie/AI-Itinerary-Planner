<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Travel Planner - Your Personal AI Travel Concierge</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="shortcut icon" type="image/png" href="favicon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            overflow-x: hidden;
        }

        .nav-bar {
            position: absolute;
            top: 0;
            right: 0;
            padding: 20px 30px;
            z-index: 1000;
        }

        .privacy-link {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
        }

        .privacy-link:hover {
            color: white;
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 20px;
            text-align: center;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .hero-icon {
            width: 120px;
            height: 120px;
            margin-bottom: 30px;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            max-width: 800px;
        }

        .hero .tagline {
            font-size: 1.5rem;
            margin-bottom: 30px;
            opacity: 0.9;
            max-width: 600px;
        }

        .hero .description {
            font-size: 1.1rem;
            margin-bottom: 40px;
            opacity: 0.8;
            max-width: 700px;
        }

        .cta-button {
            background: #ff6b6b;
            color: white;
            padding: 15px 30px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .section {
            padding: 80px 20px;
        }

        .section h2 {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 50px;
            color: #2c3e50;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
            margin-bottom: 60px;
        }

        .feature-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-card .emoji {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .feature-card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .feature-card p {
            color: #666;
            line-height: 1.6;
        }

        .screenshots {
            background: #f8f9fa;
        }

        .screenshots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .screenshot {
            text-align: center;
        }

        .screenshot img {
            max-width: 100%;
            height: auto;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .screenshot img:hover {
            transform: scale(1.05);
        }

        .testimonials {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .testimonial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .testimonial {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .testimonial p {
            font-size: 1.1rem;
            font-style: italic;
            margin-bottom: 15px;
        }

        .premium {
            background: #2c3e50;
            color: white;
        }

        .premium-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .premium-feature {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }

        .footer {
            background: #1a1a1a;
            color: white;
            text-align: center;
            padding: 40px 20px;
        }

        /* Example Itineraries Section */
        .example-itineraries {
            background: #f8f9fa;
        }

        .itinerary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .itinerary-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            overflow: hidden;
        }

        .itinerary-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
        }

        .itinerary-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }

        .itinerary-content {
            padding: 25px;
        }

        .itinerary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .itinerary-destination {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .itinerary-budget {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .budget-luxury {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .budget-mid-range {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .budget-budget {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        .itinerary-dates {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .itinerary-duration {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
        }

        .itinerary-highlights {
            margin-bottom: 15px;
        }

        .itinerary-activities {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .activity-tag {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            color: #495057;
        }

        .itinerary-cost {
            font-weight: 600;
            color: #667eea;
            font-size: 1.1rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 30px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
        }

        .btn-primary, .btn-secondary {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }

        .btn-secondary:hover {
            background: #d1d7db;
            transform: translateY(-2px);
        }

        .btn-tertiary {
            background: #ff6b35;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-tertiary:hover {
            background: #e55a2e;
            transform: translateY(-2px);
        }

        .modal-body {
            padding: 30px;
        }

        .close {
            position: absolute;
            top: 20px;
            right: 25px;
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #333;
        }

        .itinerary-details {
            max-height: 400px;
            overflow-y: auto;
        }

        .day-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .day-header {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .activity-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .activity-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .activity-time {
            color: #667eea;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .activity-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .activity-cost {
            color: #28a745;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .qr-section {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .qr-section h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        #qrcode {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .qr-section p {
            color: #666;
            margin-top: 15px;
        }

        .modal-image {
            width: 100%;
            max-width: 400px;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .nav-bar {
                padding: 15px 20px;
            }
            
            .privacy-link {
                font-size: 0.9rem;
                padding: 6px 12px;
            }
            
            .hero-icon {
                width: 80px;
                height: 80px;
                margin-bottom: 20px;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero .tagline {
                font-size: 1.2rem;
            }
            
            .section h2 {
                font-size: 2rem;
            }
            
            .screenshots-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
            }

            .itinerary-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .modal-content {
                margin: 5% auto;
                width: 95%;
            }

            .modal-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .modal-actions {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <section class="hero">
        <div class="nav-bar">
            <a href="support.html" class="privacy-link">Support</a>
            <a href="privacy.html" class="privacy-link" style="margin-left: 15px;">Privacy Policy</a>
        </div>
        <img src="icon.png" alt="AI Travel Planner Icon" class="hero-icon">
        <h1>Your Personal AI Travel Concierge</h1>
        <p class="tagline">Hours of Research in Minutes</p>
        <p class="description">Transform your travel dreams into perfectly planned adventures with AI Travel Itinerary Planner. Our intelligent AI creates personalized day-by-day itineraries in minutes, discovering hidden gems and authentic local experiences that guidebooks miss.</p>
        <!-- CTA Button - TEMPORARILY HIDDEN (uncomment to restore) -->
        <!-- <a href="#download" class="cta-button">Start Planning Your Next Adventure</a> -->
    </section>

    <!-- Features Section -->
    <section class="section">
        <div class="container">
            <h2>Smart Travel Planning. Amazing Adventures.</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="emoji">ü§ñ</div>
                    <h3>AI-Powered Planning</h3>
                    <p>Advanced AI technology creates comprehensive, personalized itineraries in minutes. Simply tell us your destination, dates, budget, and interests ‚Äì we'll handle the rest.</p>
                </div>
                <div class="feature-card">
                    <div class="emoji">‚ú®</div>
                    <h3>Personalized for You</h3>
                    <p>Every itinerary is uniquely crafted based on your budget preferences, travel dates, activity interests, and accommodation preferences.</p>
                </div>
                <div class="feature-card">
                    <div class="emoji">üó∫Ô∏è</div>
                    <h3>Comprehensive Details</h3>
                    <p>Get day-by-day schedules, restaurant recommendations, must-see attractions, hidden gems, interactive maps, and cost estimates.</p>
                </div>
                <div class="feature-card">
                    <div class="emoji">üåç</div>
                    <h3>Discover Like a Local</h3>
                    <p>Uncover secret spots only locals know, find authentic experiences beyond tourist traps, with real-time information and detailed location data.</p>
                </div>
                <div class="feature-card">
                    <div class="emoji">üí∞</div>
                    <h3>Smart Budget Planning</h3>
                    <p>Choose from budget, mid-range, or luxury options with accurate cost estimates and optimized spending for maximum experiences.</p>
                </div>
                <div class="feature-card">
                    <div class="emoji">üì±</div>
                    <h3>Seamless Experience</h3>
                    <p>Beautiful interface, offline access, trip sharing, export options, and perfect compatibility with iPhone and iPad.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Screenshots Section -->
    <section class="section screenshots">
        <div class="container">
            <h2>See It in Action</h2>
            <p style="text-align: center; font-size: 1.2rem; margin-bottom: 20px;">Discover Hidden Gems Only Locals Know</p>
            <div class="screenshots-grid">
                <div class="screenshot">
                    <img src="Images/Apple iPhone 16 Pro Max Screenshot 1.png" alt="AI Travel Planner App Screenshot 1">
                </div>
                <div class="screenshot">
                    <img src="Images/Apple iPhone 16 Pro Max Screenshot 2.png" alt="AI Travel Planner App Screenshot 2">
                </div>
                <div class="screenshot">
                    <img src="Images/Apple iPhone 16 Pro Max Screenshot 3.png" alt="AI Travel Planner App Screenshot 3">
                </div>
                <div class="screenshot">
                    <img src="Images/Apple iPhone 16 Pro Max Screenshot 4.png" alt="AI Travel Planner App Screenshot 4">
                </div>
                <div class="screenshot">
                    <img src="Images/Apple iPhone 16 Pro Max Screenshot 5.png" alt="AI Travel Planner App Screenshot 5">
                </div>
            </div>
        </div>
    </section>

    <!-- Example Itineraries Section -->
    <section class="section example-itineraries">
        <div class="container">
            <h2>See Sample Itineraries</h2>
            <p style="text-align: center; font-size: 1.2rem; margin-bottom: 40px;">Experience the power of AI planning with these real examples</p>
            <div class="itinerary-grid">
                <!-- Itinerary cards will be populated by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Itinerary Modal -->
    <div id="itineraryModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-header">
                <h2 id="modalTitle"></h2>
                <div class="modal-actions">
                    <button id="viewItineraryBtn" class="btn-primary">View Full Itinerary</button>
                    <button id="showQRBtn" class="btn-secondary">Show QR Code</button>
                    <button id="testBinaryBtn" class="btn-tertiary" onclick="testBinaryFormat()" title="Test binary format efficiency (check console)">üß™ Test Binary</button>
                </div>
            </div>
            <div class="modal-body">
                <div id="itineraryDetails" class="itinerary-details"></div>
                <div id="qrCodeSection" class="qr-section" style="display: none;">
                    <h3>Import to App</h3>
                    <div id="qrcode"></div>
                    <p>Scan this QR code with your phone to import this itinerary into the AI Travel Planner app</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Testimonials Section -->
    <section class="section testimonials">
        <div class="container">
            <h2>Why Travelers Love Us</h2>
            <div class="testimonial-grid">
                <div class="testimonial">
                    <p>"Like having a local friend in every city who knows exactly what you like"</p>
                </div>
                <div class="testimonial">
                    <p>"Saved me 10+ hours of research and planning"</p>
                </div>
                <div class="testimonial">
                    <p>"Found amazing places I never would have discovered"</p>
                </div>
                <div class="testimonial">
                    <p>"Perfect balance of popular spots and hidden gems"</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Premium Section - TEMPORARILY HIDDEN (remove display: none to restore) -->
    <section class="section premium" style="display: none;">
        <div class="container">
            <h2>Premium Features</h2>
            <p style="text-align: center; font-size: 1.2rem; margin-bottom: 40px;">Unlimited Adventures with GPT-4 Powered Planning</p>
            <div class="premium-features">
                <div class="premium-feature">
                    <h3>Unlimited Trips</h3>
                    <p>Create unlimited itineraries vs 3 free trips</p>
                </div>
                <div class="premium-feature">
                    <h3>GPT-4o Intelligence</h3>
                    <p>Enhanced AI processing for better recommendations</p>
                </div>
                <div class="premium-feature">
                    <h3>Priority Processing</h3>
                    <p>Faster generation and advanced customization</p>
                </div>
                <div class="premium-feature">
                    <h3>Advanced Discovery</h3>
                    <p>Enhanced local discovery features</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Call to Action Section - TEMPORARILY HIDDEN (remove display: none to restore) -->
    <section class="section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; display: none;">
        <div class="container">
            <h2>Start Your Next Adventure</h2>
            <p style="font-size: 1.2rem; margin-bottom: 30px;">Turn your travel dreams into detailed, actionable plans. Whether you're exploring Paris, Tokyo, New York, or anywhere in between ‚Äì your perfect itinerary is just minutes away.</p>
            <a href="#" class="cta-button" id="download">Download on the App Store</a>
            <p style="margin-top: 20px; opacity: 0.8;">Try 3 trips for free, then upgrade to premium for unlimited planning power.</p>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 AI Travel Itinerary Planner. All rights reserved.</p>
            <p style="margin-top: 10px; opacity: 0.7;">Plan Better. Travel Smarter.</p>
        </div>
    </footer>

    <!-- QR Code Library -->
    <script src="https://unpkg.com/qrious@4.0.2/dist/qrious.min.js"></script>
    
    <script>
        // Example itineraries data
        const itineraries = [
            {
                name: 'Paris Luxury Getaway',
                file: 'ExampleItineraries/paris-luxury-itinerary.json',
                description: 'Indulge in the finest Paris has to offer with Michelin-starred dining, luxury shopping, and exclusive experiences',
                duration: '5 days',
                budget: 'luxury',
                cost: '$3500-5000',
                highlights: ['Michelin-starred restaurants', 'Private Louvre tour', 'Luxury shopping on Avenue Montaigne']
            },
            {
                name: 'Tokyo Budget Adventure',
                file: 'ExampleItineraries/tokyo-budget-itinerary.json',
                description: 'Explore Tokyo\'s vibrant culture, street food, and hidden gems without breaking the bank',
                duration: '4 days',
                budget: 'budget',
                cost: '$400-600',
                highlights: ['Street food tours', 'Traditional temples', 'Anime & pop culture hotspots']
            },
            {
                name: 'New York City Classic',
                file: 'ExampleItineraries/new-york-midrange-itinerary.json',
                description: 'Experience the best of NYC with Broadway shows, world-class museums, and iconic landmarks',
                duration: '4 days',
                budget: 'mid-range',
                cost: '$1200-1800',
                highlights: ['Broadway shows', 'Top museums', 'Iconic landmarks']
            }
        ];

        let currentItineraryData = null;
        let currentItineraryFile = null;

        // Helper function for proper UTF-8 base64 encoding (from mobile app)
        function encodeBase64(str) {
            try {
                // Use the standard approach that works across all platforms
                return btoa(unescape(encodeURIComponent(str)));
            } catch (error) {
                console.error('Encoding error:', error);
                // If the standard approach fails, try a chunked approach
                try {
                    const utf8 = unescape(encodeURIComponent(str));
                    let result = '';
                    const chunkSize = 8192;
                    for (let i = 0; i < utf8.length; i += chunkSize) {
                        result += btoa(utf8.slice(i, i + chunkSize));
                    }
                    return result;
                } catch (fallbackError) {
                    console.error('Fallback encoding error:', fallbackError);
                    throw new Error('Failed to encode data');
                }
            }
        }

        // =====================================================================
        // BINARY FORMAT ENCODER (EXPERIMENTAL - MUCH MORE EFFICIENT)
        // =====================================================================
        
        class BinaryTripEncoder {
            constructor() {
                this.budgetEnum = { 'budget': 0, 'mid-range': 1, 'luxury': 2 };
                this.budgetNames = ['budget', 'mid-range', 'luxury'];
            }

            encode(tripData) {
                const buffer = [];
                
                // HEADER (3 bytes)
                buffer.push(tripData.v); // Version
                
                // Pack budget (2 bits) + hasAccommodation (1 bit)
                const budgetCode = this.budgetEnum[tripData.b] || 0;
                const flags = (budgetCode & 0x03) | ((tripData.h ? 1 : 0) << 2);
                buffer.push(flags);
                
                buffer.push(tripData.a.length); // Activity count
                
                // DATES (8 bytes) - Unix timestamps vs 48-char ISO strings
                const startDate = Math.floor(new Date(tripData.s).getTime() / 1000);
                const endDate = Math.floor(new Date(tripData.e).getTime() / 1000);
                
                // 32-bit unsigned integers
                buffer.push((startDate >> 24) & 0xFF, (startDate >> 16) & 0xFF, 
                           (startDate >> 8) & 0xFF, startDate & 0xFF);
                buffer.push((endDate >> 24) & 0xFF, (endDate >> 16) & 0xFF, 
                           (endDate >> 8) & 0xFF, endDate & 0xFF);
                
                // STRINGS (variable length with length prefixes)
                this.writeString(buffer, tripData.d); // Destination
                
                if (tripData.h && tripData.l) {
                    this.writeString(buffer, tripData.l); // Accommodation location
                }
                
                // Activities
                for (const activity of tripData.a) {
                    this.writeString(buffer, activity);
                }
                
                return new Uint8Array(buffer);
            }

            writeString(buffer, str) {
                const utf8 = new TextEncoder().encode(str);
                buffer.push(utf8.length); // Length prefix
                for (const byte of utf8) {
                    buffer.push(byte);
                }
            }

            // Convert binary to base64 for QR codes
            encodeToBase64(tripData) {
                const binaryData = this.encode(tripData);
                return btoa(String.fromCharCode(...binaryData));
            }
        }

        // Size comparison function
        function compareSizes(tripData) {
            const encoder = new BinaryTripEncoder();
            
            // Current JSON approach
            const jsonString = JSON.stringify(tripData);
            const jsonBase64 = encodeBase64(jsonString);
            
            // Binary approach
            const binaryBase64 = encoder.encodeToBase64(tripData);
            
            const savings = ((jsonBase64.length - binaryBase64.length) / jsonBase64.length * 100);
            
            console.log('=== SIZE COMPARISON ===');
            console.log('JSON + Base64:', jsonBase64.length, 'chars');
            console.log('Binary + Base64:', binaryBase64.length, 'chars');
            console.log('Savings:', savings.toFixed(1) + '%', `(${jsonBase64.length - binaryBase64.length} chars smaller)`);
            console.log('JSON data:', jsonString);
            console.log('Binary data (base64):', binaryBase64);
            
            return {
                jsonSize: jsonBase64.length,
                binarySize: binaryBase64.length,
                savings: savings,
                jsonData: jsonBase64,
                binaryData: binaryBase64
            };
        }

        // =====================================================================
        // QR CODE EXPORT OPTIMIZATION SYSTEM
        // =====================================================================
        // This system ensures QR codes remain small and scannable by:
        // 1. NEVER including image data, base64 content, or large descriptions
        // 2. Using tiered export levels (lite -> compressed)
        // 3. Aggressive size limits and validation
        // 4. Falling back to smaller exports if limits exceeded
        // 
        // LITE EXPORT: Only essential trip parameters (~200-500 chars)
        // COMPRESSED EXPORT: Minimal itinerary data (~500-2000 chars)
        // NO FULL EXPORT: Removed to prevent large QR codes
        // =====================================================================

        // Create ultra-lightweight export (just trip parameters for regeneration)
        function createLiteExport(trip) {
            return {
                v: 2, // Version 2 - lite export
                d: trip.destination,
                s: trip.startDate,
                e: trip.endDate,
                b: trip.budget,
                a: trip.activities,
                h: trip.hasAccommodation || false,
                l: trip.accommodationLocation || null
            };
        }

        // Create compressed export with essential data only (NO IMAGES OR LARGE CONTENT)
        function createCompressedExport(trip) {
            const baseData = {
                v: 1, // Version 1 - compressed export
                d: trip.destination,
                s: trip.startDate,
                e: trip.endDate,
                b: trip.budget,
                a: trip.activities.slice(0, 5), // Limit to 5 activities
                h: trip.hasAccommodation || false,
                l: trip.accommodationLocation || null
            };

            // Only include minimal itinerary data if it exists (EXPLICITLY EXCLUDE IMAGES & LARGE CONTENT)
            if (trip.itinerary && trip.itinerary.days.length > 0) {
                baseData.i = {
                    d: trip.itinerary.days.slice(0, 7).map(day => ({ // Max 7 days
                        n: day.dayNumber,
                        a: day.activities.slice(0, 4).map(activity => ({ // Max 4 activities per day
                            n: activity.name.substring(0, 50), // Limit name to 50 chars
                            t: activity.type,
                            tm: activity.time,
                            c: activity.cost,
                            ad: activity.location.address.substring(0, 80) // Limit address to 80 chars
                            // NOTE: Deliberately excluding: images, photos, descriptions, tips, websites, etc.
                        }))
                    })),
                    b: trip.itinerary.totalBudgetEstimate
                };
            }

            return baseData;
        }

        // Helper function to get image path from JSON file path
        function getImagePath(jsonFilePath) {
            return jsonFilePath.replace('.json', '.png');
        }

        // Validate export data doesn't contain large content (images, base64, etc.)
        function validateExportSize(data, type) {
            const jsonString = JSON.stringify(data);
            const maxSizes = { lite: 2000, compressed: 2000 };
            
            // Check for potential large content indicators
            if (jsonString.includes('data:image') || jsonString.includes('base64')) {
                throw new Error(`${type} export contains image/base64 data - this should never happen!`);
            }
            
            if (jsonString.length > maxSizes[type]) {
                console.warn(`${type} export too large (${jsonString.length} chars), contains:`, 
                    Object.keys(data).map(key => `${key}: ${JSON.stringify(data[key]).length} chars`));
                return false;
            }
            
            console.log(`‚úì ${type} export validated: ${jsonString.length} chars (under ${maxSizes[type]} limit)`);
            return true;
        }

        // Test binary format efficiency with sample data
        function testBinaryFormat() {
            console.log('üß™ TESTING BINARY FORMAT EFFICIENCY');
            console.log('=' * 50);
            
            const testCases = [
                {
                    name: "Short Trip",
                    data: { v: 2, d: "Tokyo", s: "2024-06-15T00:00:00.000Z", e: "2024-06-17T00:00:00.000Z", b: "budget", a: ["Food", "Temples"], h: false, l: null }
                },
                {
                    name: "Medium Trip", 
                    data: { v: 2, d: "New York City", s: "2024-06-15T00:00:00.000Z", e: "2024-06-20T00:00:00.000Z", b: "mid-range", a: ["Museums", "Broadway", "Central Park", "Shopping"], h: true, l: "Manhattan" }
                },
                {
                    name: "Long Trip",
                    data: { v: 2, d: "Paris, France", s: "2024-06-15T00:00:00.000Z", e: "2024-06-25T00:00:00.000Z", b: "luxury", a: ["Fine Dining", "Art & Museums", "Shopping", "Architecture", "Wine Tasting", "Spa"], h: true, l: "Champs-√âlys√©es District" }
                }
            ];

            let totalJsonSize = 0, totalBinarySize = 0;
            
            testCases.forEach(testCase => {
                console.log(`\n${testCase.name}:`);
                const result = compareSizes(testCase.data);
                totalJsonSize += result.jsonSize;
                totalBinarySize += result.binarySize;
            });
            
            const overallSavings = ((totalJsonSize - totalBinarySize) / totalJsonSize * 100);
            console.log(`\nüéØ OVERALL SAVINGS: ${overallSavings.toFixed(1)}% across all test cases`);
            console.log(`üìä Total chars saved: ${totalJsonSize - totalBinarySize}`);
            
            return { totalJsonSize, totalBinarySize, overallSavings };
        }

        // Generate export code like the mobile app (OPTIMIZED FOR SIZE - NO IMAGES)
        function generateExportCode(trip, useBinaryFormat = false) {
            try {
                console.log('Starting export generation for:', trip.destination);
                
                // Start with the most lightweight version
                let exportData;
                let jsonString;
                let attemptType = 'lite';
                
                // First attempt: Ultra-lite export (just parameters for regeneration)
                exportData = createLiteExport(trip);
                
                // Validate lite export doesn't contain large data
                if (!validateExportSize(exportData, 'lite')) {
                    throw new Error('Lite export contains unexpected large data');
                }
                
                jsonString = JSON.stringify(exportData);
                console.log('Lite export JSON length:', jsonString.length);
                
                // If lite is good, try compressed version with some itinerary data
                if (jsonString.length < 1000 && trip.itinerary) {
                    const compressedData = createCompressedExport(trip);
                    
                    // Validate compressed export
                    if (validateExportSize(compressedData, 'compressed')) {
                        attemptType = 'compressed';
                        exportData = compressedData;
                        jsonString = JSON.stringify(exportData);
                        console.log('‚úì Using compressed export:', jsonString.length, 'chars');
                    } else {
                        console.log('Compressed version too large, falling back to lite export');
                        // Keep using lite export (already validated above)
                    }
                }
                
                // Validate essential trip data
                if (!exportData.d || !exportData.s || !exportData.e) {
                    throw new Error('Invalid trip data - missing essential fields');
                }
                
                let base64, format;
                
                if (useBinaryFormat) {
                    // Use binary format for maximum efficiency
                    const encoder = new BinaryTripEncoder();
                    base64 = encoder.encodeToBase64(exportData);
                    format = 'binary';
                    console.log(`‚úì BINARY ${attemptType.toUpperCase()} export - Direct binary: ${base64.length} chars`);
                } else {
                    // Use JSON format (current approach)
                    base64 = encodeBase64(jsonString);
                    format = 'json';
                    console.log(`‚úì JSON ${attemptType.toUpperCase()} export - JSON: ${jsonString.length} chars, Base64: ${base64.length} chars`);
                }
                
                // Final validation - ensure QR code won't be too large
                if (base64.length > 2500) {
                    console.warn(`‚ö†Ô∏è QR code may be too large (${base64.length} chars) - consider binary format or further optimization`);
                }
                
                return {
                    code: base64,
                    type: attemptType,
                    format: format,
                    length: base64.length
                };
                
            } catch (error) {
                console.error('Error generating export code:', error);
                throw error;
            }
        }

        // Load and display itinerary cards
        function loadItineraryCards() {
            const grid = document.querySelector('.itinerary-grid');
            
            itineraries.forEach((itinerary, index) => {
                const card = document.createElement('div');
                card.className = 'itinerary-card';
                card.onclick = () => openItineraryModal(itinerary);
                
                const imagePath = getImagePath(itinerary.file);
                
                card.innerHTML = `
                    <img src="${imagePath}" alt="${itinerary.name}" class="itinerary-image" 
                         onerror="this.style.display='none'" />
                    <div class="itinerary-content">
                        <div class="itinerary-header">
                            <div class="itinerary-destination">${itinerary.name}</div>
                            <div class="itinerary-budget budget-${itinerary.budget}">${itinerary.budget}</div>
                        </div>
                        <div class="itinerary-duration">${itinerary.duration}</div>
                        <div class="itinerary-highlights">
                            <p style="color: #666; margin-bottom: 10px;">${itinerary.description}</p>
                            <div class="itinerary-activities">
                                ${itinerary.highlights.map(highlight => `<span class="activity-tag">${highlight}</span>`).join('')}
                            </div>
                        </div>
                        <div class="itinerary-cost">${itinerary.cost} per person</div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // Open itinerary modal
        async function openItineraryModal(itinerary) {
            const modal = document.getElementById('itineraryModal');
            const modalTitle = document.getElementById('modalTitle');
            
            modalTitle.textContent = itinerary.name;
            modal.style.display = 'block';
            
            // Store the current itinerary file path
            currentItineraryFile = itinerary.file;
            
            // Load the JSON data
            try {
                const response = await fetch(itinerary.file);
                if (!response.ok) throw new Error('Failed to load itinerary');
                currentItineraryData = await response.json();
                
                showItineraryDetails();
            } catch (error) {
                console.error('Error loading itinerary:', error);
                document.getElementById('itineraryDetails').innerHTML = '<p>Error loading itinerary details. Please try again.</p>';
            }
        }

        // Show itinerary details
        function showItineraryDetails() {
            if (!currentItineraryData) return;
            
            const detailsDiv = document.getElementById('itineraryDetails');
            const qrSection = document.getElementById('qrCodeSection');
            
            detailsDiv.style.display = 'block';
            qrSection.style.display = 'none';
            
            // Get the image path for the current itinerary
            const imagePath = getImagePath(currentItineraryFile);
            
            let html = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <img src="${imagePath}" alt="${currentItineraryData.destination}" class="modal-image" 
                         onerror="this.style.display='none'" />
                </div>
                <div style="margin-bottom: 20px;">
                    <h3>üóìÔ∏è ${formatDate(currentItineraryData.startDate)} - ${formatDate(currentItineraryData.endDate)}</h3>
                    <p><strong>Budget:</strong> ${currentItineraryData.budget.charAt(0).toUpperCase() + currentItineraryData.budget.slice(1)}</p>
                    <p><strong>Total Estimate:</strong> ${currentItineraryData.itinerary.totalBudgetEstimate}</p>
                    <p><strong>Activities:</strong> ${currentItineraryData.activities.join(', ')}</p>
                </div>
            `;
            
            // Add accommodation if available
            if (currentItineraryData.itinerary.accommodation && currentItineraryData.itinerary.accommodation.length > 0) {
                html += `
                    <div style="margin-bottom: 25px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                        <h4>üè® Recommended Accommodation</h4>
                        ${currentItineraryData.itinerary.accommodation.slice(0, 2).map(acc => `
                            <div style="margin: 10px 0;">
                                <strong>${acc.name}</strong> (${acc.type}) - ${acc.priceRange}<br>
                                <span style="color: #666; font-size: 0.9rem;">${acc.description}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            // Add daily itinerary
            currentItineraryData.itinerary.days.forEach(day => {
                html += `
                    <div class="day-section">
                        <div class="day-header">Day ${day.dayNumber} - ${formatDate(day.date)}</div>
                        ${day.activities.map(activity => `
                            <div class="activity-item">
                                <div class="activity-time">${activity.time} (${activity.duration})</div>
                                <div class="activity-name">${activity.name}</div>
                                <div class="activity-description">${activity.description}</div>
                                <div class="activity-cost">üí∞ ${activity.cost}</div>
                                ${activity.tips ? `<div style="font-style: italic; color: #666; margin-top: 5px;">üí° ${activity.tips}</div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;
            });
            
            // Add travel tips
            if (currentItineraryData.itinerary.tips && currentItineraryData.itinerary.tips.length > 0) {
                html += `
                    <div style="margin-top: 25px; padding: 15px; background: #fff3e0; border-radius: 8px;">
                        <h4>üí° Travel Tips</h4>
                        <ul>
                            ${currentItineraryData.itinerary.tips.map(tip => `<li style="margin: 5px 0;">${tip}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            detailsDiv.innerHTML = html;
        }

        // Show QR code
        function showQRCode() {
            if (!currentItineraryData) return;
            
            const detailsDiv = document.getElementById('itineraryDetails');
            const qrSection = document.getElementById('qrCodeSection');
            const qrCodeDiv = document.getElementById('qrcode');
            
            detailsDiv.style.display = 'none';
            qrSection.style.display = 'block';
            
            // Clear previous QR code
            qrCodeDiv.innerHTML = '';
            
            try {
                // Check if QR code library is available
                if (typeof QRious === 'undefined') {
                    throw new Error('QR code library not loaded. Please refresh the page and try again.');
                }
                
                // Generate export code like the mobile app
                const exportResult = generateExportCode(currentItineraryData);
                
                // Create a canvas element for the QR code
                const canvas = document.createElement('canvas');
                qrCodeDiv.appendChild(canvas);
                
                // Create QR code with the encoded trip data using QRious library
                const qr = new QRious({
                    element: canvas,
                    value: exportResult.code,
                    size: 256,
                    background: 'white',
                    foreground: '#333333',
                    level: 'M'
                });
                
                // Update the QR section with export info
                const existingText = qrSection.querySelector('p');
                if (existingText) {
                    const exportTypeText = exportResult.type === 'lite' ? 
                        'Contains trip parameters only. The app will regenerate the full itinerary.' :
                        'Contains essential itinerary data with limited details (no images or large content).';
                        
                    existingText.innerHTML = `
                        Scan this QR code with your phone to import this itinerary into the AI Travel Planner app.<br>
                        <small style="color: #666; margin-top: 10px; display: block;">
                            üì¶ ${exportResult.type.charAt(0).toUpperCase() + exportResult.type.slice(1)} Export (${exportResult.length} chars)<br>
                            Format: ${exportResult.format || 'json'} encoding<br>
                            ${exportTypeText}
                        </small>
                    `;
                }
                
            } catch (error) {
                console.error('Export generation error:', error);
                qrCodeDiv.innerHTML = `
                    <p style="color: #ff6b6b; text-align: center; padding: 20px;">
                        ‚ö†Ô∏è Error generating QR code<br>
                        <small>${error.message}</small><br><br>
                        <strong>Troubleshooting:</strong><br>
                        ‚Ä¢ Try refreshing the page<br>
                        ‚Ä¢ Check your internet connection<br>
                        ‚Ä¢ Try a different browser
                    </p>
                `;
            }
        }

        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
        }

        // Close modal
        function closeModal() {
            document.getElementById('itineraryModal').style.display = 'none';
            currentItineraryData = null;
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadItineraryCards();
            
            // Check if QR code library loaded
            if (typeof QRious === 'undefined') {
                console.warn('QRious library not loaded. QR code generation may not work.');
            } else {
                console.log('QRious library loaded successfully');
            }
            
            // Modal close button
            document.querySelector('.close').onclick = closeModal;
            
            // Modal buttons
            document.getElementById('viewItineraryBtn').onclick = showItineraryDetails;
            document.getElementById('showQRBtn').onclick = showQRCode;
            
            // Close modal when clicking outside
            window.onclick = function(event) {
                const modal = document.getElementById('itineraryModal');
                if (event.target === modal) {
                    closeModal();
                }
            };
        });
    </script>
</body>
</html>
